{% extends 'base.html' %}
{% block style %}
<style>
  /* 모달 스타일 */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
  }

  .modal-content {
    background-color: #fefefe;
    margin: auto;
    margin-top: 100px;
    padding: 20px;
    border: 1px solid #888;
    width: 50%;
    max-width: 500px; /* 모달창 최대 너비 설정 */
    max-height: 80%; /* 모달창 최대 높이 설정 */
    overflow-y: auto; /* 수직 스크롤 표시 */
  }

  .modal-close { 
    text-align: right;
  }
</style>
{% endblock style %}

{% block content %}
  <b>{{ review.mountain.name }}</b>
  <hr>
  <div>내용: {{ review.content }}</div>
  <div>이미지:
    {% if review.image %}
      <img src="{{ review.image.url }}" alt="">
    {% endif %}
  </div>
  <div>태그:
    {% for tag in tags %}
      {{ tag }}
    {% endfor %}
  </div>
  <hr>
  <form action="{% url 'mountains:review_delete' review.mountain.pk review.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="삭제">
  </form>
  <hr>
  <form action="{% url 'mountains:review_likes' review.mountain.pk review.pk %}" method="POST">
    {% csrf_token %}
    {% if request.user in review.like_users.all %}
      <input type="submit" value="좋아요 취소">
    {% else %}
      <input type="submit" value="좋아요">
    {% endif %}
  </form>
  {{ review.like_users.count }}
  <hr>
  <!-- 수정 버튼 -->
  <button id="editBtn">수정</button>

  <!-- 모달창 -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button id="editModalClose" class="modal-close">X</button>
      <form id="editForm" action="{% url 'mountains:review_update' review.mountain.pk review.pk %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-outline-primary">수정</button>
      </form>
    </div>
  </div>

  <script>
    // 수정 버튼 클릭 시 모달창 열기
    document.getElementById("editBtn").addEventListener("click", function() {
        document.getElementById("editModal").style.display = "block";
    });
  
    // 모달창 닫기 버튼 클릭 시 모달창 닫기
    document.getElementById("editModalClose").addEventListener("click", function() {
        document.getElementById("editModal").style.display = "none";
    });

    // 모달창 영역 외의 클릭 이벤트 처리
    window.addEventListener('click', function(event) {
      var modal = document.getElementById('editModal');
      if (event.target === modal) {
        closeModal();
      }
    });

    // 모달창 닫기 함수
    function closeModal() {
      var modal = document.getElementById('editModal');
      modal.style.display = 'none';
    }
  </script>
{% endblock %}
